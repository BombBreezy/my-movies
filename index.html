<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine-Log 2000 - 365 Challenge</title>
    <style>
        /* CORE 90s THEME */
        body { background-color: #000; font-family: "Times New Roman", serif; margin: 20px; padding: 0; color: #000; overflow-x: hidden; }
        #app-container { width: 95%; max-width: 900px; margin: 0 auto; background: #c0c0c0; border: 4px outset #fff; padding: 15px; box-sizing: border-box; box-shadow: 10px 10px 0px rgba(0,255,0,0.1); position: relative; min-height: 400px; }
        header { background: linear-gradient(90deg, #000080, #0808ff); color: white; padding: 10px; font-weight: bold; border: 2px inset #fff; margin-bottom: 15px; text-shadow: 2px 2px #000; font-size: 1.3em; }
        .box { border: 2px inset #fff; background: #c0c0c0; padding: 15px; margin-bottom: 15px; box-sizing: border-box; }
        marquee { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 5px; border: 1px solid #fff; margin-bottom: 15px; display: block; }


        /* FULL SCREEN STAGE 2: BOOT LOADER */
        #loading-stage { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 9999; align-items: center; justify-content: center; 
        }
        #loading-screen { 
            background: #000; color: #0f0; font-family: 'Courier New', monospace; 
            padding: 25px; border: 4px double #0f0; width: 85%; max-width: 400px; 
            box-shadow: 0px 0px 20px rgba(0, 255, 0, 0.4); text-align: left;
        }
        #progress-container { width: 100%; border: 1px solid #0f0; height: 22px; margin-top: 20px; background: #001100; }
        #progress-bar { width: 0%; height: 100%; background: #0f0; }
        .cursor { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }


        /* INPUTS & TABLE */
        .input-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; }
        .input-group { flex: 1; min-width: 140px; }
        .input-group label { display: block; font-weight: bold; font-size: 0.8em; margin-bottom: 4px; }
        input, select { width: 100%; border: 2px inset #fff; padding: 8px; box-sizing: border-box; font-size: 16px; background: white; }
        button { background: #c0c0c0; border: 2px outset #fff; cursor: pointer; font-weight: bold; padding: 8px 15px; font-family: "Times New Roman"; }
        button:active { border: 2px inset #fff; }


        table { width: 100%; border-collapse: collapse; background: white; border: 2px inset #808080; table-layout: fixed; }
        th { background: #808080; color: white; border: 1px solid #c0c0c0; padding: 8px; text-align: left; font-size: 0.8em; }
        td { border: 1px solid #808080; padding: 8px; font-family: "Courier New", monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .month-header { background: #000080; color: #fff; text-align: center; font-size: 0.8em; padding: 8px; font-weight: bold; letter-spacing: 2px; }
        .movie-link { color: #0000ee; cursor: pointer; text-decoration: underline; font-weight: bold; }
        .del-btn { color: red; border: 1px solid red; background: #fff; padding: 2px 6px; font-size: 0.8em; cursor: pointer; }


        /* MODAL */
        #movie-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); }
        .modal-content { background-color: #c0c0c0; margin: 10% auto; padding: 20px; border: 4px outset #fff; width: 85%; max-width: 500px; color: black; box-sizing: border-box; }
        .modal-header { background: #000080; color: white; padding: 5px; margin: -20px -20px 15px -20px; font-weight: bold; }
        .poster { float: left; margin-right: 15px; border: 2px inset #fff; width: 100px; background: #808080; }
        .clear { clear: both; }


        @media screen and (max-width: 600px) {
            body { margin: 5px; }
            #app-container { width: 100%; padding: 8px; border-width: 2px; }
            .input-row { flex-direction: column; align-items: stretch; }
            td { font-size: 13px; }
            .movie-link { white-space: normal; display: block; line-height: 1.2; }
        }
    </style>
</head>
<body>


<div id="loading-stage">
    <div id="loading-screen">
        <div>> CINE-OS v2.10.96</div>
        <div>> MEMORY TEST... 640KB OK</div>
        <div id="loading-text" style="margin-top:10px;">> INITIALIZING VAULT...</div>
        <div id="progress-container"><div id="progress-bar"></div></div>
        <div style="font-size: 0.7em; margin-top: 10px; color: #0a0;">
            SYS_DATABASE_UPLINK: CONNECTED<br>
            FILE: MOVIE_LOG.EXE <span class="cursor">_</span>
        </div>
    </div>
</div>


<div id="app-container">
    <header> 🎞️ CINE-LOG 2000: 365 CHALLENGE </header>
    <marquee>SYSTEM STABLE... LOGGING ACTIVE... DATABASE VERSION 2.2...</marquee>


    <div id="auth-section" class="box">
        <h3>Secure Login</h3>
        Email: <input type="email" id="login-email"> 
        Password: <input type="password" id="login-password"> 
        <br><br>
        <button id="login-btn">LOGIN</button>
    </div>


    <div id="main-content" style="display:none;">
        <div class="box">
            <button onclick="logout()" style="float:right">LOGOUT</button>
            <strong>🏆 PROGRESS:</strong> <span id="movie-count" style="background:#fff; padding:2px 8px; border:1px inset #808080;">0</span> / 365
            <button onclick="exportData()" style="background:#ffcc00; margin-left:10px; font-size:0.8em;">💾 EXPORT</button>
        </div>


        <div class="box">
            <strong>ADD FILM:</strong><br><br>
            <div class="input-row">
                <div class="input-group">
                    <label>DATE</label>
                    <input type="date" id="movie-date">
                </div>
                <div class="input-group">
                    <label>FILM TITLE</label>
                    <input type="text" id="movie-title" placeholder="Film Name...">
                </div>
                <div class="input-group">
                    <label>RANK</label>
                    <select id="movie-rating">
                        <option value="5">⭐⭐⭐⭐⭐</option>
                        <option value="4">⭐⭐⭐⭐</option>
                        <option value="3">⭐⭐⭐</option>
                        <option value="2">⭐⭐</option>
                        <option value="1">⭐</option>
                    </select>
                </div>
                <button onclick="saveMovie()" style="height: 38px; background: #008000; color: white;">SAVE</button>
            </div>
        </div>


        <table>
            <thead>
                <tr>
                    <th style="width:25%">DATE</th>
                    <th>TITLE</th>
                    <th style="width:20%">RANK</th>
                    <th style="width:10%">X</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>


<div id="movie-modal">
    <div class="modal-content">
        <div class="modal-header">&nbsp; FILM INFO</div>
        <div id="modal-body">Loading...</div>
        <br>
        <button onclick="closeModal()">CLOSE</button>
    </div>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


  const firebaseConfig = {
    apiKey: "AIzaSyARcsf5jtDzQ-uhcJ3V2nMIVl9JlArWYf8",
    authDomain: "cinelog-7552d.firebaseapp.com",
    projectId: "cinelog-7552d",
    storageBucket: "cinelog-7552d.firebasestorage.app",
    messagingSenderId: "180492873924",
    appId: "1:180492873924:web:d059c63c0aca97b327d991"
  };


  const OMDB_API_KEY = "ccc0f514";
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  let moviesData = [];


  // FIX: Manual Login with Loader
  document.getElementById('login-btn').addEventListener('click', () => {
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-password').value;
      
      signInWithEmailAndPassword(auth, email, pass)
      .then(() => {
          document.getElementById('auth-section').style.display = 'none';
          const stage = document.getElementById('loading-stage');
          const bar = document.getElementById('progress-bar');
          const txt = document.getElementById('loading-text');
          stage.style.display = 'flex';


          let width = 0;
          const interval = setInterval(() => {
              if (width >= 100) {
                  clearInterval(interval);
                  setTimeout(() => {
                      stage.style.display = 'none';
                      document.getElementById('main-content').style.display = 'block';
                  }, 800);
              } else {
                  width += Math.floor(Math.random() * 3) + 1; 
                  if (width > 100) width = 100;
                  bar.style.width = width + '%';
                  if(width > 20) txt.innerText = "> ESTABLISHING FIREBASE UPLINK...";
                  if(width > 45) txt.innerText = "> DECRYPTING USER_DATA...";
                  if(width > 75) txt.innerText = "> LOADING FILM_POSTERS.LIB...";
                  if(width > 92) txt.innerText = "> SYSTEM READY.";
              }
          }, 180);
      })
      .catch(err => alert("Access Denied: " + err.message));
  });


  window.logout = () => signOut(auth);
  window.closeModal = () => document.getElementById('movie-modal').style.display = "none";


  window.showInfo = async (title) => {
    const modal = document.getElementById('movie-modal');
    const body = document.getElementById('modal-body');
    modal.style.display = "block";
    body.innerHTML = "Accessing Database...";
    try {
        const res = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(title)}&apikey=${OMDB_API_KEY}`);
        const data = await res.json();
        if(data.Response === "True") {
            const rt = data.Ratings.find(r => r.Source === "Rotten Tomatoes");
            body.innerHTML = `
                <img src="${data.Poster}" class="poster">
                <strong>${data.Title}</strong> (${data.Year})<br>
                <strong>Time:</strong> ${data.Runtime}<br>
                <strong>Genre:</strong> ${data.Genre}<br>
                <strong>RT Score:</strong> <span style="color:red; font-weight:bold;">🍅 ${rt ? rt.Value : 'N/A'}</span><br><br>
                <strong>Plot:</strong> ${data.Plot}
                <div class="clear"></div><hr>
                <a href="https://www.imdb.com/title/${data.imdbID}" target="_blank">View on IMDb</a>`;
        } else { body.innerHTML = "Movie not found."; }
    } catch (e) { body.innerHTML = "Connection error."; }
  };


  window.saveMovie = () => {
    const title = document.getElementById('movie-title').value;
    const date = document.getElementById('movie-date').value;
    const rating = document.getElementById('movie-rating').value;
    if(title && date) {
        addDoc(collection(db, "movies"), { uid: auth.currentUser.uid, title, date, rating: parseInt(rating) })
        .then(() => { document.getElementById('movie-title').value = ""; });
    }
  };


  window.deleteEntry = (id) => { if(confirm("Permanently delete?")) deleteDoc(doc(db, "movies", id)); };


  onAuthStateChanged(auth, user => {
    if (user) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        const q = query(collection(db, "movies"), where("uid", "==", user.uid), orderBy("date", "desc"));
        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = "";
            let lastMonth = "";
            moviesData = [];
            snapshot.forEach(docSnap => {
                const m = docSnap.data();
                moviesData.push({ id: docSnap.id, ...m });
                const dateObj = new Date(m.date + "T00:00:00");
                const currentMonth = dateObj.toLocaleString('default', { month: 'long', year: 'numeric' });
                if (currentMonth !== lastMonth) {
                    tbody.innerHTML += `<tr><td colspan="4" class="month-header">--- ${currentMonth.toUpperCase()} ---</td></tr>`;
                    lastMonth = currentMonth;
                }
                tbody.innerHTML += `<tr>
                    <td>${m.date}</td>
                    <td><span class="movie-link" onclick="showInfo(\`${m.title.replace(/`/g, "\\`").replace(/'/g, "\\'")}\`)">${m.title}</span></td>
                    <td>${"⭐".repeat(m.rating)}</td>
                    <td><button class="del-btn" onclick="deleteEntry('${docSnap.id}')">X</button></td>
                </tr>`;
            });
            document.getElementById('movie-count').innerText = moviesData.length;
        });
    } else {
        document.getElementById('auth-section').style.display = 'block';
        document.getElementById('main-content').style.display = 'none';
    }
  });


  window.exportData = () => {
    let content = "365 MOVIE LOG\n\n";
    moviesData.forEach(m => content += `[${m.date}] ${m.title} (${m.rating}/5)\n`);
    const blob = new Blob([content], { type: "text/plain" });
    const a = Object.assign(document.createElement("a"), { href: URL.createObjectURL(blob), download: "movie_log.txt" });
    a.click();
  };
</script>
</body>
</html>