<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cine-Log 2000 </title>
    <style>
        /* CORE 90s THEME */
        body { background-color: #000000; font-family: "Times New Roman", serif; color: black; margin: 20px; }
        #app-container { width: 95%; max-width: 900px; margin: 0 auto; background: #c0c0c0; border: 4px outset #ffffff; padding: 15px; box-shadow: 10px 10px 0px rgba(0,255,0,0.1); position: relative; min-height: 400px; }
        header { background: linear-gradient(90deg, #000080, #0808ff); color: white; padding: 10px; font-weight: bold; border: 2px inset #ffffff; margin-bottom: 15px; font-size: 1.5em; text-shadow: 2px 2px #000; }
        .box { border: 2px inset #ffffff; background: #c0c0c0; padding: 15px; margin-bottom: 15px; }
        
        /* TABLE & MONTH HEADERS */
        table { width: 100%; border-collapse: collapse; background: white; border: 2px inset #808080; }
        th { background: #808080; color: white; border: 1px solid #c0c0c0; padding: 8px; text-align: left; }
        td { border: 1px solid #808080; padding: 8px; font-family: "Courier New", monospace; }
        .month-header { background: #000080; color: #ffffff; font-weight: bold; text-align: center; letter-spacing: 2px; font-size: 0.9em; padding: 5px; }
        
        /* INTERACTIVE ELEMENTS */
        .movie-link { color: #0000ee; cursor: pointer; text-decoration: underline; font-weight: bold; }
        .movie-link:hover { color: #ff0000; }
        .del-btn { color: red; border: 1px solid red; background: #fff; padding: 0px 5px; font-size: 0.8em; cursor: pointer; }
        marquee { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 5px; border: 1px solid #fff; margin-bottom: 15px; display: block; }
        .counter-pill { background: #fff; border: 2px inset #808080; padding: 5px 10px; font-weight: bold; color: #000080; }




        /* IMDb POP-UP WINDOW */
        #movie-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); }
        .modal-content { background-color: #c0c0c0; margin: 10% auto; padding: 20px; border: 4px outset #fff; width: 80%; max-width: 500px; color: black; }
        .modal-header { background: #000080; color: white; padding: 5px; margin: -20px -20px 15px -20px; font-weight: bold; }
        .poster { float: left; margin-right: 15px; border: 2px inset #fff; width: 120px; background: #808080; }
        .clear { clear: both; }
        input, select { border: 2px inset #ffffff; padding: 5px; }
        button { background: #c0c0c0; border: 2px outset #ffffff; cursor: pointer; font-weight: bold; padding: 5px 10px; }


           /* NOIR FILTER CLASS */
        .noir-mode { 
            filter: grayscale(1) sepia(0.2) contrast(1.2); 
        }
        .noir-mode #app-container {
            box-shadow: 10px 10px 0px rgba(255,255,255,0.1) !important;
        }
        /* EXTRA NOIR JITTER */
        .noir-mode::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.02); pointer-events: none; z-index: 10005;
            animation: flicker 0.1s infinite;
        }
        @keyframes flicker { 0% { opacity: 0.1; } 50% { opacity: 0.2; } 100% { opacity: 0.1; } }


       /* VHS LOADING STAGE */
        #loading-stage { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; align-items: center; justify-content: center; overflow: hidden; }
        #vhs-static { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: repeating-radial-gradient(#000 0 0.0001%, #fff 0 0.0002%) 50% 0/2500px 2500px; opacity: 0.12; animation: static-noise .2s infinite alternate; pointer-events: none; z-index: 10003; }
        @keyframes static-noise { 100% { background-position: 50% 0, 51% 51%; } }
        #scanline { width: 100%; height: 60px; background: rgba(255,255,255,0.05); position: absolute; top: -100px; left: 0; z-index: 10001; animation: scan 2.5s linear infinite; }
        @keyframes scan { 0% { top: -100px; } 100% { top: 100%; } } 
        #loading-screen { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 25px; border: 4px double #0f0; width: 85%; max-width: 400px; position: relative; z-index: 10002; text-shadow: 1px 1px #f00, -1px -1px #00f; }
         #progress-container { width: 100%; border: 2px solid #fff; height: 20px; margin-top: 20px; background: #000044; position: relative; }
        #progress-bar { width: 0%; height: 100%; background: #00ff00; box-shadow: inset -4px 0px 0px #008800; }
        .ticket-btn { background: #ff5555; color: white; border: 2px solid #a00; font-weight: bold; padding: 5px 15px; cursor: pointer; display: block; width: 110px; margin-left: auto; clip-path: polygon(10% 0, 90% 0, 100% 20%, 100% 80%, 90% 100%, 10% 100%, 0 80%, 0 20%); margin-bottom: 5px; text-align: center; }
        .small-export { background: #ffcc00; font-size: 0.7em; padding: 2px 8px; border: 2px outset #fff; cursor: pointer; display: block; width: 80px; margin-left: auto; text-align: center; }


/* MOBILE OPTIMIZATION - BIG FINGER EDITION */
@media (max-width: 600px) {
    /* 1. Reset the main container to fit phone screens */
    body { margin: 0; background-color: #000; }
    #app-container { 
        width: 100%; 
        max-width: 100%; 
        margin: 0; 
        border: none; 
        box-sizing: border-box; 
        padding: 10px;
    }


    /* 2. MAKE INPUTS & BUTTONS HUGE */
    input, select, button, .ticket-btn { 
        width: 100%;             /* Stretch across the screen */
        padding: 15px;           /* Big internal spacing (Touch Target) */
        font-size: 16px;         /* Prevents iPhone zooming */
        margin-bottom: 15px;     /* Space between items */
        box-sizing: border-box;  /* Ensures padding doesn't break width */
        height: auto;            /* Allow height to adjust */
    }


    /* 3. Stack the header elements vertically */
    .box {
        display: flex;
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
    
    /* 4. Ensure the table doesn't break the layout */
    table { font-size: 0.8em; width: 100%; }
    th, td { padding: 8px 4px; }
    
    /* 5. Fix the Modal for small screens */
    .modal-content { 
        width: 90%; 
        margin: 15% auto; 
        padding: 15px;
    }
    .poster { 
        float: none; 
        display: block; 
        margin: 0 auto 15px auto; 
        width: 150px;
    }
}




    </style>
</head>
<body>




<div id="app-container">
    <header> 🎞️ CINE-LOG 2000: THE 365 MOVIE CHALLENGE </header>
    <marquee>SESSION ACTIVE... CLICK ANY TITLE FOR FILM DATABASE INFO... TARGET: 365 FILMS...</marquee>




    <div id="auth-section" class="box">
        <h3>Restricted Access</h3>
        Email: <input type="email" id="email"> Password: <input type="password" id="password"> 
        <button onclick="login()">LOGIN</button>
    </div>




    <div id="main-content" style="display:none;">
        <div class="box">
            <button onclick="logout()" style="float:right">LOGOUT</button>
            <strong>🏆 PROGRESS:</strong> <span id="movie-count" class="counter-pill">0</span> / 365
            <button onclick="exportData()" style="background:#ffcc00; margin-left:10px;">💾 EXPORT</button>
        </div>




        <div class="box">
            <strong>LOG A NEW FILM:</strong><br><br>
            Date: <input type="date" id="movie-date">
            Title: <input type="text" id="movie-title" placeholder="e.g. Jurassic Park">
            Rating: <select id="movie-rating"><option value="5">⭐⭐⭐⭐⭐</option><option value="4">⭐⭐⭐⭐</option><option value="3">⭐⭐⭐</option><option value="2">⭐⭐</option><option value="1">⭐</option></select>
            <button onclick="saveMovie()">SAVE TO VAULT</button>
        </div>




        <table>
            <thead><tr><th>DATE</th><th>MOVIE TITLE (CLICK FOR INFO)</th><th>RATING</th><th>X</th></tr></thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>




<div id="movie-modal"><div class="modal-content"><div class="modal-header">&nbsp; FILM INFO</div><div id="modal-body">Loading...</div><br><button onclick="closeModal()">CLOSE WINDOW</button></div></div>




<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";




  const firebaseConfig = {
    apiKey: "AIzaSyARcsf5jtDzQ-uhcJ3V2nMIVl9JlArWYf8",
    authDomain: "cinelog-7552d.firebaseapp.com",
    projectId: "cinelog-7552d",
    storageBucket: "cinelog-7552d.firebasestorage.app",
    messagingSenderId: "180492873924",
    appId: "1:180492873924:web:d059c63c0aca97b327d991",
    measurementId: "G-JT3NPFZ5RH"
  };




  const OMDB_API_KEY = "ccc0f514"; // <--- PUT YOUR KEY HERE!




  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  let moviesData = [];




  window.login = () => signInWithEmailAndPassword(auth, email.value, password.value).catch(e => alert(e.message));
  window.logout = () => signOut(auth);
  window.closeModal = () => { document.getElementById('movie-modal').style.display = "none"; };




 // --- UPDATED SHOW INFO WITH GENRE, RUNTIME, & ROTTEN TOMATOES ---
  window.showInfo = async (title) => {
    const modal = document.getElementById('movie-modal');
    const body = document.getElementById('modal-body');
    modal.style.display = "block";
    body.innerHTML = "Searching Database...";
    
    try {
        const res = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(title)}&apikey=${OMDB_API_KEY}`);
        const data = await res.json();
        
        if(data.Response === "True") {
            // Find the Rotten Tomatoes score in the Ratings array
            const rtRating = data.Ratings.find(r => r.Source === "Rotten Tomatoes");
            const rtScore = rtRating ? rtRating.Value : "N/A";




            body.innerHTML = `
                <img src="${data.Poster}" class="poster">
                <strong>${data.Title}</strong> (${data.Year})<br>
                <strong>Runtime:</strong> ${data.Runtime}<br>
                <strong>Genre:</strong> ${data.Genre}<br>
                <strong>Dir:</strong> ${data.Director}<br>
                <strong>RT Score:</strong> <span style="color:red; font-weight:bold;">🍅 ${rtScore}</span><br>
                <br>
                <strong>Plot:</strong> ${data.Plot}
                <div class="clear"></div>
                <hr>
                <a href="https://www.imdb.com/title/${data.imdbID}" target="_blank">View on IMDb</a>
            `;
        } else { body.innerHTML = "Movie not found."; }
    } catch (e) { body.innerHTML = "Connection error."; }
  };








  window.saveMovie = () => {
    const title = document.getElementById('movie-title').value;
    const date = document.getElementById('movie-date').value;
    const rating = document.getElementById('movie-rating').value;
    if(title && date) { addDoc(collection(db, "movies"), { uid: auth.currentUser.uid, title, date, rating: parseInt(rating) }).then(() => { document.getElementById('movie-title').value = ""; }); }
  };




  window.deleteEntry = (id) => { if(confirm("Delete?")) deleteDoc(doc(db, "movies", id)); };




  onAuthStateChanged(auth, user => {
    if (user) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        const q = query(collection(db, "movies"), where("uid", "==", user.uid), orderBy("date", "desc"));
        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = "";
            let lastMonth = "";
            moviesData = [];
            snapshot.forEach(docSnap => {
                const m = docSnap.data();
                moviesData.push(m);
                const dateObj = new Date(m.date + "T00:00:00");
                const currentMonth = dateObj.toLocaleString('default', { month: 'long', year: 'numeric' });
                if (currentMonth !== lastMonth) {
                    tbody.innerHTML += `<tr><td colspan="4" class="month-header">--- ${currentMonth} ---</td></tr>`;
                    lastMonth = currentMonth;
                }
                 tbody.innerHTML += `
    <tr> 
        <td>${m.date}</td> 
        <td><span class="movie-link" onclick="showInfo(\`${m.title.replace(/`/g, "\\`").replace(/'/g, "\\'")}\`)">${m.title}</span></td> 
        <td>${"⭐".repeat(m.rating)}</td> 
        <td style="text-align:center;">
            <button style="background:none; border:none; cursor:pointer; font-size:1.2em;" onclick="deleteEntry('${docSnap.id}')">🗑️</button>
        </td> 
    </tr>`;


            });
            document.getElementById('movie-count').innerText = moviesData.length;
        });
    } else {
        document.getElementById('auth-section').style.display = 'block';
        document.getElementById('main-content').style.display = 'none';
    }
  });




  window.exportData = () => {
    let content = "365 CHALLENGE LOG\n\n";
    moviesData.forEach(m => content += `[${m.date}] ${m.title} (${m.rating}/5)\n`);
    const blob = new Blob([content], { type: "text/plain" });
    const a = Object.assign(document.createElement("a"), { href: URL.createObjectURL(blob), download: "movie_log.txt" });
    a.click();
  };
</script>
</body>
</html>