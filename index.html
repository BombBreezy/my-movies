<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine-Log 2000</title>
    <style>
        .noir-mode { filter: grayscale(1) sepia(0.2) contrast(1.2); }
        body { background-color: #000; font-family: "Times New Roman", serif; margin: 10px; color: #000; overflow-x: hidden; }
        #app-container { width: 98%; max-width: 900px; margin: 0 auto; background: #c0c0c0; border: 4px outset #fff; padding: 10px; position: relative; min-height: 400px; box-shadow: 10px 10px 0px rgba(0,255,0,0.1); }
        header { background: linear-gradient(90deg, #000080, #0808ff); color: #ffcc00; padding: 8px; font-weight: bold; border: 2px inset #fff; display: flex; justify-content: space-between; align-items: center; text-shadow: 2px 2px #000; }
        .box { border: 2px inset #fff; background: #c0c0c0; padding: 10px; margin-bottom: 10px; }


        /* VHS LOADING STAGE */
        #loading-stage { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; align-items: center; justify-content: center; }
        #vhs-static { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: repeating-radial-gradient(#000 0 0.0001%, #fff 0 0.0002%) 50% 0/2500px 2500px; opacity: 0.25; animation: static-noise .1s infinite; pointer-events: none; }
        @keyframes static-noise { 0% { background-position: 0 0; } 100% { background-position: 20px 20px; } }
        #loading-screen { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 25px; border: 4px double #0f0; width: 85%; max-width: 400px; z-index: 10004; position: relative; }
        #bar-container { width: 100%; border: 2px solid #fff; height: 18px; margin-top: 15px; background: #001144; }
        #bar-fill { width: 0%; height: 100%; background: #0f0; box-shadow: 0 0 10px #0f0; }


        /* CENTERED BLUE MONTH BARS */
        .month-header { background: #000080; color: #fff; padding: 8px; font-weight: bold; font-size: 0.9em; border: 2px outset #fff; margin: 20px 0 5px 0; text-align: center; letter-spacing: 4px; text-shadow: 1px 1px #000; }


        /* MOVIE MODAL */
        #modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 19999; }
        #movie-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; background: #c0c0c0; border: 4px outset #fff; z-index: 20000; padding: 15px; box-shadow: 20px 20px 0px #000; color: #000; }
        #modal-poster { width: 120px; border: 2px solid #000; float: left; margin-right: 15px; background: #333; }


        table { width: 100%; border-collapse: collapse; background: white; margin-bottom: 2px; }
        td, th { border: 1px solid #808080; padding: 6px; font-size: 0.8em; }
        .marquee-box { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 5px; border: 1px solid #fff; margin-bottom: 10px; overflow: hidden; }
        
        /* POPCORN PHYSICS */
        .popcorn { position: fixed; font-size: 30px; z-index: 20001; pointer-events: none; animation: popcorn-jump 2.2s ease-out forwards; }
        @keyframes popcorn-jump {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 1; }
            20% { transform: translate(var(--tmx), var(--tmy)) scale(1.2) rotate(180deg); }
            100% { transform: translate(var(--tfx), 110vh) scale(1) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body id="main-body">


<div id="modal-overlay" onclick="closeModal()"></div>
<div id="movie-modal">
    <div style="background:#000080; color:white; padding:5px; margin:-15px -15px 10px -15px; display:flex; justify-content:space-between; font-weight:bold; font-size: 0.8em;"><span>FILM_FACTS.EXE</span><span onclick="closeModal()" style="cursor:pointer; padding:0 8px;">[X]</span></div>
    <div id="modal-content">
        <img id="modal-poster" src="" alt="Poster">
        <div style="font-family:'Courier New', monospace; font-size:0.85em;">
            <b id="m-title" style="color:#000080; font-size:1.1em"></b><br>
            <span id="m-meta" style="font-style:italic"></span><br><br>
            <b>⭐ IMDb:</b> <span id="m-imdb"></span> | <b>🍅 RT:</b> <span id="m-rt"></span><br>
            <b>🎭 CAST:</b> <span id="m-cast"></span><br><br>
            <b>📝 PLOT:</b> <span id="m-plot"></span>
        </div>
    </div>
    <div style="clear:both"></div>
</div>


<div id="loading-stage">
    <div id="vhs-static"></div>
    <div id="loading-screen">
        <div style="float:right; color:red; font-weight:bold; animation: blink 1s infinite;">● REC</div>
        <div>PLAY 00:00:96</div>
        <div id="loading-text" style="margin-top:20px; font-weight:bold; min-height:1.2em;">> INITIALIZING...</div>
        <div id="bar-container"><div id="bar-fill"></div></div>
    </div>
</div>
<style> @keyframes blink { 50% { opacity: 0; } } </style>


<div id="app-container">
    <header>
        <span>📹 CINE-LOG 2000</span>
        <label style="font-size:0.6em; cursor:pointer">📽️ NOIR <input type="checkbox" id="noir-toggle"></label>
    </header>
    
    <div class="marquee-box" id="marquee-container">WELCOME TO THE CINE-LOG 2000. READY FOR THE SHOW?</div>


    <div id="auth-section" class="box" style="text-align:center;">
        <h3 style="color:#000080; border-bottom: 2px solid #000080; display: inline-block; padding: 5px 20px;">Member Login</h3>
        <div style="margin: 20px 0;">
            <input type="email" id="login-email" placeholder="Email" style="width:85%; padding: 8px;"><br><br>
            <input type="password" id="login-password" placeholder="Password" style="width:85%; padding: 8px;"><br><br>
            <button id="login-btn-action" style="width:85%; background:#000080; color:#ffcc00; padding:10px; font-weight:bold; border:2px outset #fff; cursor:pointer">ENTER THEATER</button>
        </div>
    </div>


    <div id="main-content" style="display:none;">
        <div class="box" style="display:flex; justify-content:space-between; align-items:center;">
            <div style="width:75%">
                <strong>🏆 YEARLY PROGRESS:</strong> <span id="movie-count">0</span>/365
                <div style="width:100%; height:14px; background:#333; border:2px solid #fff; margin-top:5px;"><div id="pixel-progress-fill" style="width:0%; height:100%; background:#0f0; transition: width 1s;"></div></div>
            </div>
            <button id="logout-btn" style="background:#ff5555; color:white; border:2px outset #fff; padding:5px; font-size:0.75em; cursor:pointer">LOGOUT</button>
        </div>


        <div class="box">
            <div style="display:flex; gap:5px; flex-wrap:wrap">
                <input type="date" id="movie-date" style="flex:1">
                <input type="text" id="movie-title" placeholder="Film Title..." style="flex:2">
                <select id="movie-rating"><option value="5">⭐⭐⭐⭐⭐</option><option value="4">⭐⭐⭐⭐</option><option value="3">⭐⭐⭐</option><option value="2">⭐⭐</option><option value="1">⭐</option></select>
                <button id="save-btn" style="background:#008000; color:white; border:2px outset #fff; padding:8px; cursor:pointer; font-weight:bold;">SAVE ENTRY</button>
            </div>
        </div>


        <div id="log-display"></div>
    </div>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


  const firebaseConfig = { apiKey: "AIzaSyARcsf5jtDzQ-uhcJ3V2nMIVl9JlArWYf8", authDomain: "cinelog-7552d.firebaseapp.com", projectId: "cinelog-7552d", storageBucket: "cinelog-7552d.firebasestorage.app", messagingSenderId: "180492873924", appId: "1:180492873924:web:d059c63c0aca97b327d991" };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const OMDB_KEY = "ccc0f514";


  document.getElementById('noir-toggle').onchange = (e) => document.getElementById('main-body').classList.toggle('noir-mode', e.target.checked);
  document.getElementById('logout-btn').onclick = () => signOut(auth);
  window.closeModal = () => { document.getElementById('modal-overlay').style.display='none'; document.getElementById('movie-modal').style.display='none'; };


  const quotes = ["\"I'll be back.\" 🤖", "\"May the Force be with you.\" ✨", "\"Bond. James Bond.\" 🍸", "\"Stay gold, Ponyboy.\" 🌅", "\"Life finds a way.\" 🦖", "\"Here's looking at you, kid.\" 🎞️", "\"You're gonna need a bigger boat.\" 🦈"];
  const funPhrases = ["> RETICULATING SPLINES...", "> BUFFERING POPCORN...", "> REWINDING TAPE...", "> CLEANING VHS HEADS...", "> ADJUSTING TRACKING...", "> EXPANDING KERNELS...", "> LOADING TRAILERS..."];


  // LOGIN BUTTON RE-WIRED
  document.getElementById('login-btn-action').addEventListener('click', () => {
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-password').value;
      if(!email || !pass) return alert("Please enter credentials.");
      
      signInWithEmailAndPassword(auth, email, pass).then(() => {
          document.getElementById('auth-section').style.display = 'none';
          document.getElementById('loading-stage').style.display = 'flex';
          let w = 0;
          const inv = setInterval(() => {
              if (w >= 100) { 
                  clearInterval(inv); 
                  document.getElementById('loading-stage').style.display = 'none'; 
                  document.getElementById('main-content').style.display = 'block'; 
              } else { 
                w += (Math.random() > 0.7 ? 1 : 2); 
                document.getElementById('bar-fill').style.width = w + '%'; 
                if(w % 12 == 0) document.getElementById('loading-text').innerText = funPhrases[Math.floor(Math.random()*funPhrases.length)];
              }
          }, 110);
      }).catch(err => alert("Login Failed: " + err.message));
  });


  document.getElementById('save-btn').onclick = () => {
      const title = document.getElementById('movie-title').value;
      const date = document.getElementById('movie-date').value;
      const rating = document.getElementById('movie-rating').value;
      if(title && date) {
          addDoc(collection(db, "movies"), { uid: auth.currentUser.uid, title, date, rating: parseInt(rating) }).then(() => {
              document.getElementById('movie-title').value = "";
              for(let i=0; i<35; i++) spawnPopcorn();
          });
      }
  };


  function spawnPopcorn() {
      const p = document.createElement('div'); p.className='popcorn'; p.innerText='🍿';
      p.style.left = (Math.random()*90+5)+'%'; p.style.top='50%';
      p.style.setProperty('--tmx', (Math.random()*300-150)+'px');
      p.style.setProperty('--tmy', (Math.random()*-400-100)+'px');
      p.style.setProperty('--tfx', (Math.random()*600-300)+'px');
      p.style.setProperty('--tr', (Math.random()*1200)+'deg');
      document.body.appendChild(p); setTimeout(() => p.remove(), 2200);
  }


  window.showInfo = async (t) => {
      const res = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(t)}&apikey=${OMDB_KEY}`);
      const d = await res.json();
      if(d.Response === "True") {
          document.getElementById('m-title').innerText = d.Title.toUpperCase();
          document.getElementById('m-meta').innerText = `${d.Year} | ${d.Runtime} | ${d.Genre}`;
          document.getElementById('m-poster').src = d.Poster !== "N/A" ? d.Poster : "https://via.placeholder.com/120x180?text=NO+IMAGE";
          document.getElementById('m-imdb').innerText = d.imdbRating || "N/A";
          const rt = d.Ratings.find(r => r.Source === "Rotten Tomatoes");
          document.getElementById('m-rt').innerText = rt ? rt.Value : "N/A";
          document.getElementById('m-cast').innerText = d.Actors;
          document.getElementById('m-plot').innerText = d.Plot;
          document.getElementById('modal-overlay').style.display = 'block';
          document.getElementById('movie-modal').style.display = 'block';
      }
  };


  window.deleteEntry = (id) => { if(confirm("Discard this entry?")) deleteDoc(doc(db,'movies',id)); };


  onAuthStateChanged(auth, user => {
      if (user) {
          document.getElementById('auth-section').style.display = 'none';
          document.getElementById('main-content').style.display = 'block';
          document.getElementById('marquee-container').innerHTML = `<marquee scrollamount="5">${quotes.join("   🎬   ")}</marquee>`;
          const q = query(collection(db, "movies"), where("uid", "==", user.uid), orderBy("date", "desc"));
          onSnapshot(q, snapshot => {
              const logDiv = document.getElementById('log-display'); logDiv.innerHTML = "";
              let count = 0; let lastMonth = "";
              snapshot.forEach(docSnap => {
                  const m = docSnap.data(); count++;
                  const dObj = new Date(m.date + "T12:00:00");
                  const monthOnly = dObj.toLocaleString('default', { month: 'long' }).toUpperCase();
                  const fullDisplayDate = dObj.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' }).replace(/\//g, '-');


                  if (monthOnly !== lastMonth) {
                      lastMonth = monthOnly;
                      const h = document.createElement('div'); h.className='month-header'; h.innerText=monthOnly;
                      logDiv.appendChild(h);
                  }
                  const tbl = document.createElement('table');
                  const cleanT = m.title.replace(/'/g, "\\'");
                  tbl.innerHTML = `<tr>
                      <td style="width:85px; font-family: monospace;">${fullDisplayDate}</td>
                      <td><span style="color:blue;text-decoration:underline;cursor:pointer" onclick="showInfo('${cleanT}')">${m.title}</span></td>
                      <td style="width:95px;letter-spacing:-2px">${"⭐".repeat(m.rating)}</td>
                      <td style="width:35px;text-align:center"><button style="border:none;background:none;cursor:pointer" onclick="deleteEntry('${docSnap.id}')">🗑️</button></td>
                  </tr>`;
                  logDiv.appendChild(tbl);
              });
              document.getElementById('movie-count').innerText = count;
              document.getElementById('pixel-progress-fill').style.width = Math.min((count/365)*100, 100) + '%';
          });
      } else {
          document.getElementById('auth-section').style.display = 'block';
          document.getElementById('main-content').style.display = 'none';
      }
  });
</script>
</body>
</html>