<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cine-Log 2000 - Your Movie Vault</title>
    <style>
        /* 90s GEO-CITIES AESTHETIC - UPDATED */
        body { 
            background-color: #000000; /* Changed to Black */
            font-family: "Times New Roman", Times, serif; 
            color: black; 
            margin: 20px; 
        }
        #app-container { 
            width: 95%; 
            max-width: 900px; 
            margin: 0 auto; 
            background: #c0c0c0; 
            border: 4px outset #ffffff; 
            padding: 15px; 
            box-shadow: 10px 10px 0px rgba(0,255,0,0.2); /* Subtle green glow */
        }
        header { 
            background: linear-gradient(90deg, #000080, #0808ff); 
            color: white; 
            padding: 10px; 
            font-weight: bold; 
            border: 2px inset #ffffff; 
            margin-bottom: 15px; 
            font-size: 1.5em; 
            text-shadow: 2px 2px #000; 
        }
        .box { 
            border: 2px inset #ffffff; 
            background: #c0c0c0; 
            padding: 15px; 
            margin-bottom: 15px; 
        }
        
        /* TABLE STYLES */
        table { width: 100%; border-collapse: collapse; background: white; border: 2px inset #808080; margin-top: 10px; }
        th { background: #808080; color: white; border: 1px solid #c0c0c0; padding: 8px; text-align: left; }
        td { border: 1px solid #808080; padding: 8px; font-family: "Courier New", Courier, monospace; }
        
        /* FORM ELEMENTS */
        input, select { border: 2px inset #ffffff; padding: 5px; background: #fff; }
        button { background: #c0c0c0; border: 2px outset #ffffff; cursor: pointer; font-weight: bold; padding: 5px 15px; }
        button:active { border: 2px inset #ffffff; background: #a0a0a0; }
        
        /* MARQUEE STYLE */
        marquee { 
            background: #000; 
            color: #0f0; 
            font-family: 'Courier New', monospace; 
            padding: 5px; 
            border: 1px solid #fff; 
            margin-bottom: 15px;
            display: block;
        }
        .counter-pill { background: #fff; border: 2px inset #808080; padding: 5px 10px; font-weight: bold; color: blue; }
    </style>
</head>
<body>


<div id="app-container">
    <header> 🎞️ CINE-LOG 2000: VERSION 1.7 [REGISTERED] </header>
    <marquee>SESSION ACTIVE... DATABASE CONNECTED... WELCOME BACK TO THE VAULT...</marquee>


    <div id="auth-section" class="box">
        <h3>Restricted Access - Members Only</h3>
        Email: <input type="email" id="email" placeholder="you@aol.com"> 
        Password: <input type="password" id="password"> 
        <br><br>
        <button onclick="login()">LOGIN</button>
        <button onclick="signup()">CREATE ACCOUNT</button>
    </div>


    <div id="main-content" style="display:none;">
        <div class="box">
            <button onclick="logout()" style="float:right">LOGOUT / EXIT</button>
            <strong>LOG A NEW FILM:</strong><br><br>
            Date: <input type="date" id="movie-date">
            Title: <input type="text" id="movie-title" placeholder="e.g. Jurassic Park">
            Rating: 
            <select id="movie-rating">
                <option value="5">⭐⭐⭐⭐⭐</option>
                <option value="4">⭐⭐⭐⭐</option>
                <option value="3">⭐⭐⭐</option>
                <option value="2">⭐⭐</option>
                <option value="1">⭐</option>
            </select>
            <button onclick="saveMovie()">SAVE TO VAULT</button>
        </div>


        <table>
            <thead>
                <tr>
                    <th>WATCH DATE</th>
                    <th>MOVIE TITLE</th>
                    <th>RATING</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>




// OBSERVER & AUTO-SORTING LIST (NEWEST AT TOP)
  onAuthStateChanged(auth, user => {
    if (user) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';


        // --- THE CHANGE: orderBy("date", "desc") ---
        // This puts 2026-01-04 at the top and 2026-01-01 at the bottom.
        const q = query(
            collection(db, "movies"), 
            where("uid", "==", user.uid), 
            orderBy("date", "desc") 
        );


        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = "";
            moviesData = [];
            snapshot.forEach(docSnap => {
                const m = docSnap.data();
                moviesData.push(m);
                tbody.innerHTML += `<tr>
                    <td>${m.date}</td>
                    <td><strong>${m.title}</strong></td>
                    <td>${"⭐".repeat(m.rating)}</td>
                    <td><button class="del-btn" onclick="deleteEntry('${docSnap.id}')">X</button></td>
                </tr>`;
            });
            document.getElementById('movie-count').innerText = moviesData.length;
        }, (err) => {
            console.error("Sorting Error:", err);
            // NOTE: If you just changed from 'asc' to 'desc', 
            // Firebase might ask for a NEW index link in the F12 console.
            if(err.code === "failed-precondition") {
                alert("New sort order detected! Check the F12 console for the activation link.");
            }
        });
    } else {
        document.getElementById('auth-section').style.display = 'block';
        document.getElementById('main-content').style.display = 'none';
    }
  });


</script>
</body>
</html>