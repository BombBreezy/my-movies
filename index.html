<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cine-Log 2000 - Your Movie Vault</title>
    <style>
        /* 90s GEO-CITIES AESTHETIC */
        body { background-color: #008080; font-family: "Times New Roman", Times, serif; color: black; margin: 20px; }
        #app-container { width: 95%; max-width: 900px; margin: 0 auto; background: #c0c0c0; border: 4px outset #ffffff; padding: 15px; box-shadow: 10px 10px 0px rgba(0,0,0,0.5); }
        header { background: linear-gradient(90deg, #000080, #0808ff); color: white; padding: 10px; font-weight: bold; border: 2px inset #ffffff; margin-bottom: 15px; font-size: 1.5em; text-shadow: 2px 2px #000; }
        .login-box, .movie-entry, .stats-box { border: 2px inset #ffffff; background: #c0c0c0; padding: 15px; margin-bottom: 15px; }
        
        /* TABLE STYLES */
        table { width: 100%; border-collapse: collapse; background: white; border: 2px inset #808080; margin-top: 10px; }
        th { background: #808080; color: white; border: 1px solid #c0c0c0; padding: 8px; text-align: left; }
        td { border: 1px solid #808080; padding: 8px; font-family: "Courier New", Courier, monospace; }
        
        /* FORM ELEMENTS */
        input, select { border: 2px inset #ffffff; padding: 5px; background: #fff; }
        button { background: #c0c0c0; border: 2px outset #ffffff; cursor: pointer; font-weight: bold; padding: 5px 15px; }
        button:active { border: 2px inset #ffffff; background: #a0a0a0; }
        button.export-btn { background: #ffcc00; color: black; margin-top: 10px; }
        
        .status-light { color: #006400; font-weight: bold; font-size: 0.9em; margin-left: 10px; }
        marquee { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 3px; border: 1px solid #fff; }
        .counter-pill { background: #fff; border: 2px inset #808080; padding: 5px 10px; font-weight: bold; color: blue; }
    </style>
</head>
<body>


<div id="app-container">
    <header> 🎞️ CINE-LOG 2000: VERSION 1.2 [REGISTERED] </header>
    <marquee>SESSION ACTIVE... DATABASE CONNECTED... WELCOME BACK, USER!</marquee>


    <div id="auth-section" class="login-box">
        <h3>Restricted Access - Members Only</h3>
        Email: <input type="email" id="email" placeholder="you@aol.com"> 
        Password: <input type="password" id="password"> 
        <br><br>
        <button onclick="login()">LOGIN</button>
        <button onclick="signup()">CREATE ACCOUNT</button>
    </div>


    <div id="main-content" style="display:none;">
        <div class="stats-box">
            <strong>VAULT STATISTICS:</strong> 
            Movies Logged: <span id="movie-count" class="counter-pill">0</span>
            <button class="export-btn" onclick="exportData()">💾 DOWNLOAD LOG (.TXT)</button>
        </div>


        <div class="movie-entry">
            <strong>LOG A NEW FILM:</strong><br><br>
            Date: <input type="date" id="movie-date">
            Title: <input type="text" id="movie-title" placeholder="e.g. Jurassic Park">
            Rating: 
            <select id="movie-rating">
                <option value="5">⭐⭐⭐⭐⭐ (Classic)</option>
                <option value="4">⭐⭐⭐⭐ (Great)</option>
                <option value="3">⭐⭐⭐ (Good)</option>
                <option value="2">⭐⭐ (Bad)</option>
                <option value="1">⭐ (Avoid)</option>
            </select>
            <span id="save-status" class="status-light"></span>
        </div>


        <table id="movie-list">
            <thead>
                <tr>
                    <th>WATCH DATE</th>
                    <th>MOVIE TITLE</th>
                    <th>RATING</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</div>


<script type="module">
  // FIREBASE SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries


// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyARcsf5jtDzQ-uhcJ3V2nMIVl9JlArWYf8",
  authDomain: "cinelog-7552d.firebaseapp.com",
  projectId: "cinelog-7552d",
  storageBucket: "cinelog-7552d.firebasestorage.app",
  messagingSenderId: "180492873924",
  appId: "1:180492873924:web:d059c63c0aca97b327d991",
  measurementId: "G-JT3NPFZ5RH"
};


// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
  };


  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  let moviesData = []; // Local cache for export


  // AUTH LOGIC
  window.login = () => signInWithEmailAndPassword(auth, email.value, password.value).catch(err => alert(err.message));
  window.signup = () => createUserWithEmailAndPassword(auth, email.value, password.value).catch(err => alert(err.message));


  onAuthStateChanged(auth, user => {
    if (user) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        loadMovies(user.uid);
    }
  });


  // AUTO-SAVE LOGIC
  const checkFields = () => {
    const title = document.getElementById('movie-title').value;
    const date = document.getElementById('movie-date').value;
    const rating = document.getElementById('movie-rating').value;


    if(title && date) {
        document.getElementById('save-status').innerText = "AUTOSAVING...";
        addDoc(collection(db, "movies"), {
            uid: auth.currentUser.uid,
            title, date, rating, timestamp: Date.now()
        }).then(() => {
            document.getElementById('save-status').innerText = "✅ SAVED TO VAULT";
            document.getElementById('movie-title').value = ""; // Reset title for next entry
            setTimeout(() => { document.getElementById('save-status').innerText = ""; }, 2000);
        });
    }
  };


  document.getElementById('movie-title').addEventListener('blur', checkFields);
  document.getElementById('movie-rating').addEventListener('change', checkFields);


  // LOAD & COUNT DATA
  function loadMovies(uid) {
    const q = query(collection(db, "movies"), where("uid", "==", uid), orderBy("date", "desc"));
    onSnapshot(q, (snapshot) => {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = "";
        moviesData = [];
        snapshot.forEach(doc => {
            const data = doc.data();
            moviesData.push(data);
            tbody.innerHTML += `<tr><td>${data.date}</td><td>${data.title}</td><td>${"⭐".repeat(data.rating)}</td></tr>`;
        });
        document.getElementById('movie-count').innerText = moviesData.length;
    });
  }


  // EXPORT TO TXT
  window.exportData = () => {
    let content = "CINE-LOG 2000 - MOVIE EXPORT\n============================\n\n";
    moviesData.forEach(m => {
        content += `[${m.date}] ${m.title} - ${m.rating}/5 Stars\n`;
    });
    const blob = new Blob([content], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "my_movie_log.txt";
    a.click();
  };
</script>
</body>
</html>